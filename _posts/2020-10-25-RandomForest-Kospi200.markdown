---
layout: post
title:  RandomForest를 활용한 Kospi200 주가 방향 예측
date:   2020-10-25
image:  arrows.jpg
tags:   Data Finance
---
## RandomForest란?

먼저, **의사결정트리(Decision Tree)**에 대한 이해가 필요하다. 의사결정트리는 아래의 그림과 같이 `기린`이라는 정답을 찾기 위해 질문을 이어가며 구분을 하는 방식이다. 즉, 각 데이터들이 가진 속성들로부터 패턴을 찾아낸 후 분류 혹은 회귀 문제를 풀 수 있도록 하는 머신러닝 모델이다. 의사결정나무는 복잡한 데이터에 대해 높은 예측력을 낼 수 있는 모델이라고 할 수 있다. 그러나 train set에는 매우 높은 예측도를 보이지만, test set에는 낮은 예측도를 보이는 `Overfitting` 문제가 발생할 수 있다.

<img width="505" alt="스크린샷 2020-10-25 오후 5 07 56" src="https://user-images.githubusercontent.com/70478154/97102035-64d5ff00-16e5-11eb-8d71-cbe69bc85467.png">

이를 보완해줄 수 있는 것이 **랜덤포레스트(RandomForest)**이다. 나무들이 모여 숲을 이루는 것처럼 이름에서도 알 수 있듯, 이 모델도 역시 여러 의사결정트리들을 만들고 그 트리들로부터 결과를 도출해낸다. 즉, 전체 train set에서 중복을 허용하여 샘플링한 데이터들을 개별 의사결정트리에 적용하고 이를 종합한 결론을 도출하는 방법으로, 다수의 학습 알고리즘을 사용하는 **앙상블(Ensemble) 기법** 중 하나이다. 이러한 모델은 Overfitting 문제를 줄여 일반화된 모델을 만들 수 있다는 장점을 가지고 있다.<BR/><BR/><BR/><BR/>

## 분석 목적

해외 증시, 주요 경제, 금융 지표들을 바탕으로 Kospi200 주가의 방향을 얼마나 효과적으로 예측할 수 있는지 알아보고자 한다. 또한, 주가 방향 예측에 가장 영향을 미치는 요소들을 파악하고자 한다. 더 나아가, 이러한 지표들이 주가 방향 예측에 가장 크게 영향을 줄 수 있는 시기를 `일주일` `한달` `3개월` `6개월`로 나누어 알아보고자 한다.<BR/><BR/><BR/><BR/>

## 데이터 소개

target 데이터인 Kospi200은 Kodex200 ETF의 주가를 활용했다. 일자 별 데이터들을 바탕으로 예측을 하는 것이기 때문에 다음 날 종가와 `일주일` `한달` `3개월` `6개월` 뒤의 종가와 비교하여 수익률을 산출했고, 이를 `1, 0, -1`로 분류했다. 기간에 따라 누적되는 수익률 크기에 차이가 있기 때문에 분류 기준점을 다르게 적용했다.

* `일주일` 기준 target : **수익률 >= 1%**면 `1`, **1% > 수익률 > 0%**면 `0`, **수익률 <= 0%**면 `-1`
* `한달` 기준 target : **수익률 >= 2%**면 `1`, **2% > 수익률 > 0%**면 `0`, **수익률 <= 0%**면 `-1`
* `3개월` 기준 target : **수익률 >= 4%**면 `1`, **4% > 수익률 > 0%**면 `0`, **수익률 <= 0%**면 `-1`
* `6개월` 기준 target : **수익률 >= 6%**면 `1`, **4% > 수익률 > 0%**면 `0`, **수익률 <= 0%**면 `-1`

예측을 위한 feature는 날짜를 제외하고 총 18개를 사용했다.

* `경기선행지수` : 3~6개월 후의 경기 흐름을 가늠하는 지표이다.
* `수출증가율` : 수출금액지수를 바탕으로 증가율을 산출했다.
* `콜금리` : 금융기관 간 거래에서의 단기 금리이다.
* `CD 금리` : CD(양도성예금증서)가 발행되어 유통시장에서 거래될 때 적용되는 금리이다.
* `DAX 선물` : 독일의 종합주가지수인 DAX 선물 가격이다.
* `DOW 선물` : 미국의 종합주가지수인 DOW 선물 가격이다.
* `FTSE 선물` : 영국의 FTSE 사가 발표하는 세계 주가지수에 대한 선물 가격이다.
* `Nikkei225 선물` : 일본의 종합주가지수인 Nikkei 선물 가격이다.
* `금 선물` `WTI 선물` : 각각 금, 원유에 대한 선물 가격이다.
* `국채 3년` : 우리나라 3년 만기 국채 가격이다.
* `미국 국채 10년` `미국 국채 3년`
* `유로/달러 환율` `원/달러 환율`
* `달러 선물 인덱스` : 달러인덱스는 유로, 엔, 파운드, 캐나다 달러, 스웨덴 크로네, 스위스 프랑 등 경제 규모가 크거나 통화가치가 안정적인 6개국 통화를 기준으로 산정한 미 달러화 가치를 지수화한 것으로, 이에 대한 선물이다.
* `VIX` : S&P500 지수옵션의 향후 30일 간의 변동성에 대한 시장의 기대를 나타낸 지수이다.
* `VKOSPI`: KOSPI200 지수옵션의 미래변동성을 측정한 지수이다.

target 기준에 따라 대략 2009년 4월부터 각각 2020년 1월, 6월, 9월, 10월까지의 데이터를 활용했다.








